<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DamageDetective â€¢ DamageDetective</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DamageDetective">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DamageDetective</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/DamageDetective.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>DamageDetective</h1>
            
      

      <div class="d-none name"><code>DamageDetective.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://alicenjoyhenning.github.io/DamageDetective/">DamageDetective</a></span><span class="op">)</span></span></code></pre></div>
<p>The demonstrations below can be followed immediately after installing
the package by loading the dummy data provided,
<code>test_counts</code>, an artificial PBMC dataset containing 500
cells and 10009 genes.</p>
<div class="section level2">
<h2 id="simulating-damaged-cells-simulate_counts">Simulating Damaged Cells (<code>simulate_counts</code>)<a class="anchor" aria-label="anchor" href="#simulating-damaged-cells-simulate_counts"></a>
</h2>
<p>A core feature of <code>DamageDetective</code> is the ability to
predict how scRNA-seq data might appear if cells had undergone RNA
damage. This is modeled by simulating the loss of cytoplasmic RNA, where
greater loss corresponds to increased damage severity.</p>
<p>The <code>simulate_counts</code> function applies this simulation,
allowing users to introduce damage to a defined proportion of cells in
an input count matrix. While primarily used within
<code>detect_damage</code>, it is also available for standalone use to
aid exploratory data analysis and ground truth dataset generation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulating damage in 25% of cells</span></span>
<span><span class="va">damaged_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_counts.html">simulate_counts</a></span><span class="op">(</span></span>
<span>  count_matrix <span class="op">=</span> <span class="va">test_counts</span>,</span>
<span>  damage_proportion <span class="op">=</span> <span class="fl">0.20</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="DamageDetective_files/figure-html/plot1-1.png" alt="Plot 1. Scatter plot of simulated damaged data." width="672"><p class="caption">
Plot 1. Scatter plot of simulated damaged data.
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># View dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">damaged_counts</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10009   500</span></span>
<span></span>
<span><span class="co"># Preview the altered counts</span></span>
<span><span class="va">damaged_counts</span><span class="op">$</span><span class="va">matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;                 GGCTCGACATCTACGA GCGACCAAGAATCTCC GGAATAATCTTAACCT</span></span>
<span><span class="co">#&gt; MTCO1P12                       0                0                0</span></span>
<span><span class="co">#&gt; MTATP6P1                       0                2                1</span></span>
<span><span class="co">#&gt; ENSG00000291215                0                0                0</span></span>
<span><span class="co">#&gt; LINC00115                      0                0                0</span></span>
<span><span class="co">#&gt; LINC01128                      0                2                0</span></span>
<span><span class="co">#&gt;                 TGGGAAGGTCGAACAG ACTATCTAGAGGTAGA</span></span>
<span><span class="co">#&gt; MTCO1P12                       0                0</span></span>
<span><span class="co">#&gt; MTATP6P1                       1                0</span></span>
<span><span class="co">#&gt; ENSG00000291215                0                0</span></span>
<span><span class="co">#&gt; LINC00115                      0                0</span></span>
<span><span class="co">#&gt; LINC01128                      0                0</span></span></code></pre></div>
<p>The function also outputs a <code>qc_summary</code> table comparing
quality control metrics before and after simulation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">damaged_counts</span><span class="op">$</span><span class="va">qc_summary</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Cell Damaged_Level Original_Features New_Features</span></span>
<span><span class="co">#&gt; 1 GGCTCGACATCTACGA     0.0000000               358          358</span></span>
<span><span class="co">#&gt; 2 GCGACCAAGAATCTCC     0.0000000              2110         2110</span></span>
<span><span class="co">#&gt; 3 GGAATAATCTTAACCT     0.0000000               959          959</span></span>
<span><span class="co">#&gt; 4 TGGGAAGGTCGAACAG     0.0000000               849          849</span></span>
<span><span class="co">#&gt; 5 ACTATCTAGAGGTAGA     0.3452416               508          355</span></span>
<span><span class="co">#&gt;   Original_MitoProp New_MitoProp Original_RiboProp New_RiboProp</span></span>
<span><span class="co">#&gt; 1        0.08073394   0.08073394       0.100917431   0.10091743</span></span>
<span><span class="co">#&gt; 2        0.05470840   0.05470840       0.109818085   0.10981808</span></span>
<span><span class="co">#&gt; 3        0.13801115   0.13801115       0.157063197   0.15706320</span></span>
<span><span class="co">#&gt; 4        0.10303030   0.10303030       0.196270396   0.19627040</span></span>
<span><span class="co">#&gt; 5        0.53384615   0.66095238       0.009230769   0.01047619</span></span></code></pre></div>
<p>Additionally, <code>simulate_counts</code> produces plots
illustrating quality metric distributions before and after simulated
damage that are displayed by default and accessed as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">damaged_counts</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<div class="figure">
<img src="DamageDetective_files/figure-html/plot2-1.png" alt="Plot 2. Scatter plot of simulated damaged data." width="672"><p class="caption">
Plot 2. Scatter plot of simulated damaged data.
</p>
</div>
<p>To control the severity and distribution of simulated damage, users
can adjust:<br>
- <code>target_damage</code>: Specifies the range of RNA loss per
cell.<br>
- <code>damage_distribution</code>: Defines how damage is spread across
cells.</p>
<p>For example, simulating severe damage (70-99% RNA loss) with a
right-skewed distribution:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">damaged_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_counts.html">simulate_counts</a></span><span class="op">(</span></span>
<span>  count_matrix <span class="op">=</span> <span class="va">test_counts</span>,</span>
<span>  damage_proportion <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  target_damage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>  damage_distribution <span class="op">=</span> <span class="st">"right_skewed"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="DamageDetective_files/figure-html/plot3-1.png" alt="Plot 3. Scatter plot of right-skewed simulated damaged data." width="672"><p class="caption">
Plot 3. Scatter plot of right-skewed simulated damaged data.
</p>
</div>
<p>For more details, refer to:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ?simulate_counts()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="detecting-damaged-cells-detect_damage">Detecting Damaged Cells (<code>detect_damage</code>)<a class="anchor" aria-label="anchor" href="#detecting-damaged-cells-detect_damage"></a>
</h2>
<p><code>DamageDetective</code> offers automated damage assessment via
the <code>detect_damage</code> function, which assigns each cell a
damage score.</p>
<p>Before using <code>detect_damage</code>, it is important to ensure
damage simulation is as accurate as possible for your data. Based on
observations of true single cell data, we find that ribosomal RNA loss
occurs less frequently than expected based on abundance alone and needs
to be adjusted by a numerical value (<code>ribosome_penalty</code>)
between 0 and 1.</p>
<p>While lower values for <code>ribosome_penalty</code> (closer to zero)
better approximate true data, with a default of 0.01, this can be
refined for the input data using the <code>select_penalty</code>
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penalty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_penalty.html">select_penalty</a></span><span class="op">(</span></span>
<span>  count_matrix <span class="op">=</span> <span class="va">test_counts</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Testing penalty of 0.001...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.006...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.011...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.016...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.021...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.026...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.031...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.036...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.041...</span></span>
<span><span class="co">#&gt; Testing penalty of 0.046...</span></span>
<span><span class="co">#&gt; Stopping early: dTNN is no longer improving.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">penalty</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.026</span></span></code></pre></div>
<p>For more details, refer to:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ?select_penalty()</span></span></code></pre></div>
<p>Using the refined ribosomal penalty found, the damage detection can
then be run as follows,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">damage_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_damage.html">detect_damage</a></span><span class="op">(</span></span>
<span>  count_matrix <span class="op">=</span> <span class="va">test_counts</span>, </span>
<span>  ribosome_penalty <span class="op">=</span> <span class="va">penalty</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulating cells between 1e-05 and 0.08 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.1 and 0.3 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.3 and 0.5 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.5 and 0.7 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.7 and 0.9 RNA loss...</span></span>
<span><span class="co">#&gt; Computing pANN...</span></span></code></pre></div>
<div class="figure">
<img src="DamageDetective_files/figure-html/plot4-1.png" alt="Plot 4. Scatter plot of damage levels detected." width="672"><p class="caption">
Plot 4. Scatter plot of damage levels detected.
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># View the damage scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">damage_results</span><span class="op">$</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             Cells DamageDetective</span></span>
<span><span class="co">#&gt; GGCTCGACATCTACGA GGCTCGACATCTACGA      0.64166667</span></span>
<span><span class="co">#&gt; GCGACCAAGAATCTCC GCGACCAAGAATCTCC      0.14615385</span></span>
<span><span class="co">#&gt; GGAATAATCTTAACCT GGAATAATCTTAACCT      0.20769231</span></span>
<span><span class="co">#&gt; TGGGAAGGTCGAACAG TGGGAAGGTCGAACAG      0.17692308</span></span>
<span><span class="co">#&gt; ACTATCTAGAGGTAGA ACTATCTAGAGGTAGA      0.86129032</span></span>
<span><span class="co">#&gt; GCATGATCACTCTGTC GCATGATCACTCTGTC      0.02909727</span></span></code></pre></div>
<p>Cells with high damage scores can be filtered out to retain
high-quality data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_counts</span> <span class="op">&lt;-</span> <span class="va">test_counts</span><span class="op">[</span>, <span class="va">damage_results</span><span class="op">$</span><span class="va">qc_summary</span><span class="op">$</span><span class="va">DamageDetective</span> <span class="op">&lt;</span> <span class="fl">0.7</span><span class="op">]</span></span></code></pre></div>
<p>For convenience, <code>detect_damage</code> can return a filtered
count matrix directly by enabling <code>filter_counts = TRUE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_damage.html">detect_damage</a></span><span class="op">(</span></span>
<span>  count_matrix <span class="op">=</span> <span class="va">test_counts</span>,</span>
<span>  ribosome_penalty <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  filter_counts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  filter_threshold <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>  generate_plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulating cells between 1e-05 and 0.08 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.1 and 0.3 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.3 and 0.5 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.5 and 0.7 RNA loss...</span></span>
<span><span class="co">#&gt; Simulating cells between 0.7 and 0.9 RNA loss...</span></span>
<span><span class="co">#&gt; Computing pANN...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">filtered_counts</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dgCMatrix"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "Matrix"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">filtered_counts</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10009   474</span></span></code></pre></div>
<p>For more details, refer to:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ?detect_damage()</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alicen Henning.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
