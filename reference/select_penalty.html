<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>select_penalty — select_penalty • DamageDetective</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="select_penalty — select_penalty"><meta name="description" content="Recommended prerequisite function to detect_damage() that estimates the
ideal ribosome_penalty value for the input data."><meta property="og:description" content="Recommended prerequisite function to detect_damage() that estimates the
ideal ribosome_penalty value for the input data."><meta property="og:image" content="https://alicenjoyhenning.github.io/DamageDetective/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DamageDetective</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/alicenjoyhenning/DamageDetective/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>select_penalty</h1>
      <small class="dont-index">Source: <a href="https://github.com/alicenjoyhenning/DamageDetective/blob/main/R/select_penalty.R" class="external-link"><code>R/select_penalty.R</code></a></small>
      <div class="d-none name"><code>select_penalty.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Recommended prerequisite function to detect_damage() that estimates the
ideal <code>ribosome_penalty</code> value for the input data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">select_penalty</span><span class="op">(</span></span>
<span>  <span class="va">count_matrix</span>,</span>
<span>  organism <span class="op">=</span> <span class="st">"Hsap"</span>,</span>
<span>  mito_quantile <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  penalty_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  penalty_step <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_penalty_trials <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  target_damage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>  damage_distribution <span class="op">=</span> <span class="st">"right_skewed"</span>,</span>
<span>  distribution_steepness <span class="op">=</span> <span class="st">"steep"</span>,</span>
<span>  beta_shape_parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stability_limit <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  damage_proportion <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  annotated_celltypes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_output <span class="op">=</span> <span class="st">"penalty"</span>,</span>
<span>  ribosome_penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-count-matrix">count_matrix<a class="anchor" aria-label="anchor" href="#arg-count-matrix"></a></dt>
<dd><p>Matrix or dgCMatrix containing the counts from
single cell RNA sequencing data.</p></dd>


<dt id="arg-organism">organism<a class="anchor" aria-label="anchor" href="#arg-organism"></a></dt>
<dd><p>String specifying the organism of origin of the input
data where there are two standard options,</p><ul><li><p>"Hsap"</p></li>
<li><p>"Mmus"</p></li>
</ul><p>If a user wishes to use a non-standard organism they must input a list
containing strings for the patterns to match mitochondrial and ribosomal
genes of the organism. If available, nuclear-encoded genes that are likely
retained in the nucleus, such as in nuclear speckles, must also
be specified. An example for humans is below,</p><ul><li><p>organism = list(mito_pattern = "^MT-",
ribo_pattern = "^(RPS|RPL)",
nuclear = c("NEAT1","XIST", "MALAT1"))</p></li>
<li><p>Default is "Hsap"</p></li>
</ul></dd>


<dt id="arg-mito-quantile">mito_quantile<a class="anchor" aria-label="anchor" href="#arg-mito-quantile"></a></dt>
<dd><p>Numeric specifying below what proportion of
mitochondrial content cells are used for sampling for simulation.</p><ul><li><p>Default is 0.75, meaning only cells with less than 0.75 proportion of
mitochondrial counts are sampled for simulated.</p></li>
</ul></dd>


<dt id="arg-penalty-range">penalty_range<a class="anchor" aria-label="anchor" href="#arg-penalty-range"></a></dt>
<dd><p>Numerical vector of length 2 specifying the lower
and upper limit of values tested for the ribosomal penalty.</p><ul><li><p>Default is c(0.1, 1).</p></li>
</ul></dd>


<dt id="arg-penalty-step">penalty_step<a class="anchor" aria-label="anchor" href="#arg-penalty-step"></a></dt>
<dd><p>Numeric specifying the value added to each increment
of penalty tested.</p><ul><li><p>Default is 0.05.</p></li>
</ul></dd>


<dt id="arg-max-penalty-trials">max_penalty_trials<a class="anchor" aria-label="anchor" href="#arg-max-penalty-trials"></a></dt>
<dd><p>Numeric specifying the maximum number of
iterations for the ribosomal penalty value.</p><ul><li><p>Default is 14.</p></li>
</ul></dd>


<dt id="arg-target-damage">target_damage<a class="anchor" aria-label="anchor" href="#arg-target-damage"></a></dt>
<dd><p>Numeric vector specifying the upper and lower range of
the level of damage that will be introduced.</p>
<p>Here, damage refers to the amount of cytoplasmic RNA lost by a cell where
values closer to 1 indicate more loss and therefore more heavily damaged
cells.</p><ul><li><p>Default is c(0.65, 1)</p></li>
</ul></dd>


<dt id="arg-damage-distribution">damage_distribution<a class="anchor" aria-label="anchor" href="#arg-damage-distribution"></a></dt>
<dd><p>String specifying whether the distribution of
damage levels among the damaged cells should be shifted towards the
upper or lower range of damage specified in 'target_damage' or follow
a symmetric distribution between them. There are three valid options:</p><ul><li><p>"right_skewed"</p></li>
<li><p>"left_skewed"</p></li>
<li><p>"symmetric"</p></li>
<li><p>Default is "left_skewed"</p></li>
</ul></dd>


<dt id="arg-distribution-steepness">distribution_steepness<a class="anchor" aria-label="anchor" href="#arg-distribution-steepness"></a></dt>
<dd><p>String specifying how concentrated the spread
of damaged cells are about the mean of the target distribution specified in
'target_damage'. Here, an increase in steepness manifests in a more
apparent skewness.There are three valid options:</p><ul><li><p>"shallow"</p></li>
<li><p>"moderate"</p></li>
<li><p>"steep"</p></li>
<li><p>Default is "steep"</p></li>
</ul></dd>


<dt id="arg-beta-shape-parameters">beta_shape_parameters<a class="anchor" aria-label="anchor" href="#arg-beta-shape-parameters"></a></dt>
<dd><p>Numeric vector that allows for the shape
parameters of the beta distribution to defined explicitly. This offers
greater flexibility than allowed by the 'damage_distribution' and
'distribution_steepness' parameters and will override the defaults they
offer.</p><ul><li><p>Default is 'NULL'</p></li>
</ul></dd>


<dt id="arg-stability-limit">stability_limit<a class="anchor" aria-label="anchor" href="#arg-stability-limit"></a></dt>
<dd><p>Numeric specifying the number of additional iterations
allotted after the median minimum distance of the artificial cells to the
true cells is greater than the previous minimum distance.</p>
<p>The idea here is that if a higher penalty is not causing an improvement
in the output, there is little need to continue testing with larger
penalties.</p><ul><li><p>Default is 3.</p></li>
</ul></dd>


<dt id="arg-damage-proportion">damage_proportion<a class="anchor" aria-label="anchor" href="#arg-damage-proportion"></a></dt>
<dd><p>Numeric describing what proportion
of the input data should be altered to resemble damaged data.</p><ul><li><p>Must range between 0 and 1.</p></li>
</ul></dd>


<dt id="arg-annotated-celltypes">annotated_celltypes<a class="anchor" aria-label="anchor" href="#arg-annotated-celltypes"></a></dt>
<dd><p>Boolean specifying whether input matrix has
cell type information stored.</p><ul><li><p>Default is FALSE</p></li>
</ul></dd>


<dt id="arg-return-output">return_output<a class="anchor" aria-label="anchor" href="#arg-return-output"></a></dt>
<dd><p>String specifying what form the output of the function
should take where the options are either,</p><ul><li><p>"penalty"</p></li>
<li><p>"full"</p></li>
</ul><p>"Penalty" will return only the ribosomal penalty that resulted in the
best performance (the smallest median distance between artificial and
true cells). While "full" will return the ideal ribosomal penalty and
the median distance between artificial and true cells for each penalty
tested. This allows insight into how the penalty was selected.</p><ul><li><p>Default is "penalty".</p></li>
</ul></dd>


<dt id="arg-ribosome-penalty">ribosome_penalty<a class="anchor" aria-label="anchor" href="#arg-ribosome-penalty"></a></dt>
<dd><p>Numeric specifying the factor by which the
probability of loosing a transcript from a ribosomal gene is multiplied by.
Here, values closer to 0 represent a greater penalty.</p><ul><li><p>Default is 1.</p></li>
</ul></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Numeric specifying the random seed to ensure reproducibility of
the function's output. Setting a seed ensures that the random sampling
and perturbation processes produce the same results when the function
is run multiple times with the same input data and parameters.</p><ul><li><p>Default is 7.</p></li>
</ul></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Boolean specifying whether messages and function progress
should be displayed in the console.</p><ul><li><p>Default is TRUE.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Numeric representing the ideal ribosomal penalty for an input
dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Based on observations of true single cell data, we find that ribosomal RNA
loss occurs less frequently than expected based on abundance alone. To
adjust for this, the probability scores of ribosomal gene loss are multiplied
by a numerical value (<code>ribosome_penalty</code>) between 0 and 1. Lower values
(closer to zero) better approximate true data, with a default of 0.01,
though this can often be greatly refined for the input data.</p>
<p>Refinement follows a similar workflow to detect_damage(), but rather than
evaluating the similarity of true cells to sets of artificial cells to
infer their level of damage, we evaluate the similarity of artificial cells
to true cells to infer the effectiveness of their approximation to true
data. This is calculated using the distance to the nearest true cell (dTNN)
taken for each artificial cell found using the Euclidean distance matrix.
The median dTNN is computed iteratively until stabilization or a worsening
trend. The ideal <code>ribosomal_penalty</code> is then selected as that which
generated the lowest dTNN.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_counts"</span>, package <span class="op">=</span> <span class="st">"DamageDetective"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">penalty</span> <span class="op">&lt;-</span> <span class="fu">select_penalty</span><span class="op">(</span></span></span>
<span class="r-in"><span> count_matrix <span class="op">=</span> <span class="va">test_counts</span>,</span></span>
<span class="r-in"><span> stability_limit <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span> max_penalty_trials <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span> seed <span class="op">=</span> <span class="fl">7</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing penalty of 0.1...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Maximum penalty trials reached (1). Stopping.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alicen Henning.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

